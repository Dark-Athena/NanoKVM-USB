name: Build and Release NanoKVM-USB
on:
  push:
    tags:
      - 'v*'   # é€šè¿‡æ ‡ç­¾è§¦å‘ï¼ˆå¦‚ v1.0.1ï¼‰
  workflow_dispatch:   # æ·»åŠ æ‰‹åŠ¨å¯åŠ¨æ”¯æŒ
    inputs:            # å¯é€‰ï¼šè‡ªå®šä¹‰è¾“å…¥å‚æ•°
      version:
        description: 'è¾“å…¥ç‰ˆæœ¬å· (å¦‚ 1.0.1)'
        required: true
jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup PNPM
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Install Dependencies
        working-directory: ./desktop
        run: pnpm install 

      - name: Build
        working-directory: ./desktop
        run: pnpm build:win --publish never # å…³é”®ä¿®æ­£ï¼šç§»é™¤ç®¡ç†å‘˜ææƒ

      - name: Verify Build Output
        run: ls -R desktop/dist  # è°ƒè¯•ç”¨

      - name: ğŸš€ Publish Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ steps.find-exe.outputs.version }}  # åŠ¨æ€ç”Ÿæˆæ ‡ç­¾
          name: "NanoKVM USB v${{ steps.find-exe.outputs.version }}"
          files: |
            ${{ steps.find-exe.outputs.exe_file }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
